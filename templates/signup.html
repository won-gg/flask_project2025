{% extends "index.html" %}
{% block section %}
{% with mesg = get_flashed_messages() %}
{% if mesg != [] %}
<script>alert("{{ mesg[0] }}")</script>
{% endif %}
{% endwith %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/loginSignup.css') }}">

<div class="signup-container">
  <div class="logo">
    <img src="{{ url_for('static', filename='assets/svg/logo.svg') }}" alt="Logo SVG" />
    <h1>오e 마켓</h1>
    <p>이화여대 학생 전용 마켓플레이스</p>
  </div>

  <form method="post" action="/signup_post" class="signup-form">
    <label>학번</label>
    <input type="text" name="idNum" placeholder="1234567" required>

    <label>이메일</label>
    <input type="email" name="email" placeholder="ewha@ewhain.net" required>

    <label>전화번호</label>
    <input type="text" name="phoneNum" placeholder="010-1234-5678" required>

    <label>아이디</label>
    <div class="id-check">
      <input type="text" name="id" id="userid" placeholder="ewhaewha" required>
      <button type="button" class="check-btn" id="check-btn">중복 확인</button>
    </div>
    <input type="hidden" id="id_checked" value="false">

    <p id="id-check-result" style="font-size:14px; margin-top:4px;"></p>

    <label>비밀번호</label>
    <input type="password" name="pw" placeholder="비밀번호를 입력하세요 (8자 이상)" required>

    <label>비밀번호 확인</label>
    <input type="password" name="pwCheck" placeholder="비밀번호를 다시 입력하세요" required>

    <div class="agreements">
      <label><input type="checkbox" required> 이용약관에 동의합니다 <span>(필수)</span></label>
      <label><input type="checkbox" required> 개인정보 처리방침에 동의합니다 <span>(필수)</span></label>
      <label><input type="checkbox"> 마케팅 정보 수신에 동의합니다 <span class="choice">(선택)</span></label>
    </div>

    <button type="submit" class="submit-btn">회원가입</button>
  </form>

  <div class="login-link">
    이미 계정이 있으신가요? <a href="/login">로그인</a>
  </div>
</div>
<script>
document.getElementById("check-btn").addEventListener("click", function() {
    const userId = document.getElementById("userid").value.trim();

    if (!userId) {
        alert("아이디를 입력해주세요!");
        return;
    }

    fetch(`/check_id/${userId}`)
        .then(res => res.json())
        .then(data => {
            const resultText = document.getElementById("id-check-result");
            const idChecked = document.getElementById("id_checked");

            if (data.available) {
                resultText.style.color = "green";
                resultText.innerText = "사용 가능한 아이디입니다.";
                idChecked.value = "true";
            } else {
                resultText.style.color = "red";
                resultText.innerText = "이미 존재하는 아이디입니다.";
                idChecked.value = "false";
            }
        })
});
document.getElementById("signup-form").addEventListener("submit", function(e) {
    const checked = document.getElementById("id_checked").value;

    if (checked !== "true") {
        e.preventDefault();
        alert("아이디 중복 확인을 먼저 진행해주세요.");
    }
});
</script>
{% endblock section %}

