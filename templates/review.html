{% extends "index.html" %}

{% block section %}

<!-- 리뷰 전체 조회 -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/reviews.css') }}">

<main class="review-list">
  <div class="review-header">
    <h2>전체 리뷰 조회 ({{total}})</h2>
  </div>

  <!-- 리뷰 카드 리스트 -->
  <div class="reviews-grid">
    {% for review_id, review in reviews.items() %}
    <article class="review-card" data-id="{{ review_id }}">
      <div class="review-image">
        <img src="{{ url_for('static', filename = 'images/' + review.img_path[0]) }}" alt="상품 이미지">
      </div>
      <div class="review-body">
        <p class="item-name">{{ review.item_name }}</p>
        <p class="review-title">{{ review.title }}</p>
        <p class="review-rating">매너 점수: {{ review.rating }}</p>
      </div>
    </article>
    {% endfor %}
  </div>

  <!-- 페이지네이션 -->
  {% if total > 0 %}
  <div class="pagination">
    <button type="button" 
      onclick="window.location.href='{{ url_for('review.view_review', page=(page-1 if page > 0 else 0)) }}'"
      {% if page == 0 %}disabled style="opacity: 0.5; cursor: not-allowed;"{% endif %}>
      &laquo;
    </button>
    {% for i in range(page_count) %}
    <button type="button" 
      class="{% if i == page %}active{% endif %}"
      onclick="window.location.href='{{ url_for('review.view_review', page=i) }}'">
      {{ i + 1 }}
    </button>
    {% endfor %}
    <button type="button" 
      onclick="window.location.href='{{ url_for('review.view_review', page=(page+1 if page < page_count-1 else page_count-1)) }}'"
      {% if page >= page_count - 1 %}disabled style="opacity: 0.5; cursor: not-allowed;"{% endif %}>
      &raquo;
    </button>
  </div>
  {% endif %}
</main>

<!-- ==============================
     리뷰 상세 모달창 (새 구조)
================================== -->
<div id="reviewModal" class="modal">
  <div class="modal-content-box">
    <span class="close">&times;</span>
    
    <!-- 상단 이미지 4장 -->
    <div class="image-row" id="modal-images"></div>

    <!-- 하단 좌우 영역 -->
    <div class="bottom-section">
      <!-- 왼쪽 내용 -->
      <div class="left-content">
        <div class="meta-info" style="height:30px;">
          <p id="modal-item" class="item-name"></p>
          <p id="modal-rating" class="rating"></p>
        </div>

        <h2 id="modal-title" class="review-title"></h2>

        <div class="review-content-box" style="height:150px;">
          <p id="modal-content"></p>
        </div>

        <div class="hashtags" id="modal-tags"></div>
      </div>

      <!-- 오른쪽 작성자 프로필 -->
      <div class="right-profile">
        <div class="author-photo">
          <img class="profile-img" src="{{ url_for('static', filename='assets/svg/profile_default.svg') }}" alt="profile SVG" />
        </div>
        <p id="modal-author" class="author-name"></p>
        <p id="modal-author-rating" class="author-rating"></p>
      </div>
    </div>
  </div>
</div>
<link rel="stylesheet" href="{{ url_for('static', filename='css/review_detail.css') }}">



<!-- Flask에서 넘겨주는 데이터 -->
<script id="reviewData" type="application/json">
  {{ reviews | tojson }}
</script>

<!-- 모달 기능 JS -->
<script src="{{ url_for('static', filename='js/review_modal.js') }}"></script>

{% endblock section %}
